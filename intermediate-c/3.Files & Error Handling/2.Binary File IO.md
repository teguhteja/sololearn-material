
# Binary File I/O

## Binary File Mode Options

When working with binary files, the `fopen()` function supports the following modes:

- **`rb`**: Open for reading (file must exist)
- **`wb`**: Open for writing (file need not exist)
- **`ab`**: Open for appending (file need not exist)
- **`rb+`**: Open for reading and writing from the beginning
- **`wb+`**: Open for reading and writing, overwriting the file
- **`ab+`**: Open for reading and writing, appending to the file

## Binary File Functions

- **`fwrite(ptr, item_size, num_items, fp)`**: Writes `num_items` items of size `item_size` from the pointer `ptr` to the file pointed to by `fp`.

- **`fread(ptr, item_size, num_items, fp)`**: Reads `num_items` items of size `item_size` from the file pointed to by `fp` into memory pointed to by `ptr`.

- **`fclose(fp)`**: Closes the file opened with `fp`, returning `0` if successful. Returns `EOF` if there is an error closing the file.

- **`feof(fp)`**: Returns `0` when the end of the file stream has been reached.

**Example Program:**

```c
#include <stdio.h>

int main() {
  FILE *fptr;
  int arr[10];
  int x[10];
  int k;

  /* Generate array of numbers */
  for (k = 0; k < 10; k++)
    arr[k] = k;

  /* Write array to file */
  fptr = fopen("datafile.bin", "wb");
  fwrite(arr, sizeof(arr[0]), sizeof(arr)/sizeof(arr[0]), fptr);
  fclose(fptr);

  /* Read array from file */
  fptr = fopen("datafile.bin", "rb");
  fread(x, sizeof(arr[0]), sizeof(arr)/sizeof(arr[0]), fptr);
  fclose(fptr);

  /* Print array */
  for (k = 0; k < 10; k++)
    printf("%d ", x[k]);
  return 0;
}
```

This program writes an array of integers to a binary file and reads it back. The item size and number of items are determined using the size of an element and the size of the entire array.

**Note:** File extensions indicate the type of data (e.g., `.txt` for text files, `.bin` for binary files, `.csv` for comma-separated values, `.dat` for data files), but do not determine the format of the data.

**Fill in the blanks to write the array to the file and close it:**

```c
FILE* fptr;
int arr[5] = {1, 2, 3, 4, 5};
fptr = fopen("datafile.bin", "wb");
fwrite(arr, sizeof(arr[0]), sizeof(arr)/sizeof(arr[0]), fptr);
fclose(fptr);
```

## Controlling the File Pointer

Functions in `stdio.h` allow you to control the file pointer's location in a binary file:

- **`ftell(fp)`**: Returns a `long int` value corresponding to the file pointer position in bytes from the start of the file.

- **`fseek(fp, num_bytes, from_pos)`**: Moves the file pointer position by `num_bytes` bytes relative to `from_pos`, which can be one of:
  - `SEEK_SET`: Start of file
  - `SEEK_CUR`: Current position
  - `SEEK_END`: End of file

**Example Program:**

```c
#include <stdio.h>
#include <string.h>

typedef struct {
  int id;
  char name[20];
} item;

int main() { 
  FILE *fptr;
  item first, second, secondf;

  /* Create records */
  first.id = 10276;
  strcpy(first.name, "Widget");
  second.id = 11786;
  strcpy(second.name, "Gadget");
  
  /* Write records to a file */
  fptr = fopen("info.dat", "wb");
  fwrite(&first, sizeof(first), 1, fptr);
  fwrite(&second, sizeof(second), 1, fptr);
  fclose(fptr); 

  /* Read records from file */
  fptr = fopen("info.dat", "rb");

  /* Seek second record */
  fseek(fptr, sizeof(item), SEEK_SET);
  fread(&secondf, sizeof(item), 1, fptr);
  printf("%d  %s\n", secondf.id, secondf.name);
  fclose(fptr);
  return 0;
}
```

In this program, two `item` records are written to a file. To read the second record, `fseek()` moves the file pointer to `sizeof(item)` bytes from the start of the file. For example, to move to the fourth record, seek to `3 * sizeof(item)` from the beginning of the file (SEEK_SET).

**Fill in the blanks to seek to the second record in the file:**

```c
typedef struct {
  int id;
  char name[20];
} item;

FILE* fptr = fopen("info.dat", "rb");
fseek(fptr, 1 * sizeof(item), SEEK_SET);
```