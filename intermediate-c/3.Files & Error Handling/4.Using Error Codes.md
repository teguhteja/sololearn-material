```markdown
# 4. Using Error Codes

## Using `errno`

Some library functions, such as `fopen()`, set an error code when they do not execute as expected. The error code is set in a global variable named `errno`, which is defined in the `errno.h` header file. When using `errno`, you should set it to `0` before calling a library function.

To output the error code stored in `errno`, use `fprintf` to print to the `stderr` file stream, the standard error output to the screen. Using `stderr` is a matter of convention and good programming practice.

You can output the `errno` through other means, but it will be easier to keep track of your exception handling if you only use `stderr` for error messages.

To use `errno`, you need to declare it with the statement `extern int errno;` at the top of your program (or you can include the `errno.h` header file).

**Example:**

```c
#include <stdio.h>
#include <stdlib.h>
#include <errno.h>

extern int errno;

int main() {
  FILE *fptr;

  errno = 0;
  fptr = fopen("c:\\nonexistantfile.txt", "r");
  if (fptr == NULL) {
    fprintf(stderr, "Error opening file. Error code: %d\n", errno);
    exit(EXIT_FAILURE);
  }

  fclose(fptr);
  return 0;
}
```

**Fill in the blanks:**

Type in the header name where the `errno` variable is declared.

```c
#include <errno.h>
```

## The `perror` and `strerror` Functions

When a library function sets `errno`, a cryptic error number is assigned. For a more descriptive message about the error, you can use `perror()`. You can also obtain the message using `strerror()` in the `string.h` header file, which returns a pointer to the message text.

`perror()` must include a string that will precede the actual error message. Typically, there is no need for both `perror()` and `strerror()` for the same error, but both are used in the program below for demonstration purposes:

**Example:**

```c
#include <stdio.h>
#include <stdlib.h>
#include <errno.h>
#include <string.h>

int main() {
  FILE *fptr;

  errno = 0;
  fptr = fopen("c:\\nonexistantfile.txt", "r");
  if (fptr == NULL) {
    perror("Error");
    fprintf(stderr, "%s\n", strerror(errno));
    exit(EXIT_FAILURE);
  }

  fclose(fptr);
  return 0;
}
```

To list error codes:

```c
#include <stdio.h>
#include <stdlib.h>
#include <errno.h>
#include <string.h>

extern int errno;

int main() {
    for (int x = 0; x < 135; x++)
      fprintf(stderr, "%d: %s\n", x, strerror(x));
}
```

**Fill in the blanks to try to open a file and print the error message using the `perror()` message:**

```c
FILE* fptr = fopen("test.txt", "r");
if (fptr == NULL) {
  perror("Error");
  exit(EXIT_FAILURE);
}
```

## `EDOM` and `ERANGE` Error Codes

Some of the mathematical functions in the `math.h` library set `errno` to the defined macro value `EDOM` when a domain is out of range. Similarly, the `ERANGE` macro value is used when there is a range error.

**Example:**

```c
#include <stdio.h>
#include <errno.h>
#include <string.h>
#include <math.h>

int main() { 
  float k = -5;
  float num = 1000;
  float result;

  errno = 0;
  result = sqrt(k);
  if (errno == 0)
    printf("%f ", result);
  else if (errno == EDOM)
    fprintf(stderr, "%s\n", strerror(errno));

  errno = 0;
  result = exp(num);
  if (errno == 0)
    printf("%f ", result);
  else if (errno == ERANGE)
    fprintf(stderr, "%s\n", strerror(errno));

  return 0;
}
```

**What is the error code specifying that the domain is out of range?**

- `EDOM`
- `EOPEN`
- `ERANGE`

## The `feof` and `ferror` Functions

In addition to checking for a `NULL` file pointer and using `errno`, the `feof()` and `ferror()` functions can be used for determining file I/O errors:

- **`feof(fp)`**: Returns a nonzero value if the end of stream has been reached, `0` otherwise. `feof` also sets `EOF`.

- **`ferror(fp)`**: Returns a nonzero value if there is an error, `0` for no error.

**Example:**

```c
#include <stdio.h>
#include <errno.h>
#include <stdlib.h>
#include <string.h>

int main() {  
  FILE *fptr;
  int c;

  errno = 0;
  fptr = fopen("c:\\myfile.txt", "r");
  if (fptr == NULL) {
    fprintf(stderr, "Error opening file. %s\n", strerror(errno));
    exit(EXIT_FAILURE);
  }

  while ((c = getc(fptr)) != EOF) /* read the rest of the file */
    printf("%c", c);

  if (ferror(fptr)) {
    printf("I/O error reading file.");
    exit(EXIT_FAILURE);
  }
  else if (feof(fptr))
    printf("End of file reached.");

  fclose(fptr);
  return 0;
}
```

**Fill in the blanks to open the file for reading and check if the end of file is reached:**

```c
FILE* fptr = fopen("test", "r");
if (feof(fptr)) {
  printf("End of file reached.");
}
```
```